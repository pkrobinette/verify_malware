function [data, labels, mal_key] = read_imgs_all()
% Loads all images (normalized) from each class of the malimg dataset 

    path = "../../../archive/malimg_dataset/validation_resize/";

    files = dir(path);
    mal_dirs = [files.isdir];
    mal_dirs = files(mal_dirs);
    mal_key = {mal_dirs(3:end).name};

    % Initial estimates (will be adjusted later)
    estNumImages = 1000; 
    data = zeros(64, 64, 1, estNumImages);
    labels = zeros(1, estNumImages);

    totalImages = 0;

    for i = 1:length(mal_key)
        mal_path = path+mal_key{i};
        imgList = dir(fullfile(mal_path, '*.png'));
        
        for j = 1:length(imgList)
            im = imread(fullfile(mal_path, imgList(j).name));
            im = double(im)./255;

            totalImages = totalImages + 1;
            
            % Dynamically resize arrays if needed
            if totalImages > size(data, 4)
                data = cat(4, data, zeros(64, 64, 1, estNumImages));
                labels = cat(2, labels, zeros(1, estNumImages));
            end

            data(:, :, 1, totalImages) = im;
            labels(:, totalImages) = i;
        end
    end

    % Trim the excess elements
    data = data(:, :, 1, 1:totalImages);
    labels = labels(:, 1:totalImages);
end