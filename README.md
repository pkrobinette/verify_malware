# Artifact: Investigating the Verification of Neural Network Malware Classifiers
This artifact is used to reproduce the results shown in _Investigating the Verification of Neural Network Malware Classifiers_. 

## Requirements and Installation
### Docker:
The following docker image was built with the following resources:

<img src="utils/docker-requirements.png" width="300">

---
### Matlab: NNV Installation

#### 1. System requirements

> **OS:** Windows 10, Linux, MacOS

>**RAM:** at least 32 GB

>**Matlab version:** 2022b or later

> Detailed installation of NNV is available at: https://github.com/verivital/nnv#installation

### 2. Clone NNV repository using the recursive option as it has submodules:

`git clone --recursive https://github.com/verivital/nnv.git`

### 3. Install NNV (install.m)
In Matlab, navigate to the `code/nnv/` folder. Execute the `install.m` script, which will set up various dependencies (mostly via tbxmanager). This should also set up the path correctly within Matlab, so all dependencies are available.

`install`

https://github.com/verivital/nnv/blob/master/code/nnv/install.m

If Matlab is restarted to work again, either `install.m` or `startup_nnv.m` must be executed again. Alternatively, one can execute `savepath` to update the path after executing install (but in this case, Matlab may need to have been launched with administrative privilege).

`savepath`

https://github.com/verivital/nnv/blob/master/code/nnv/startup_nnv.m


## Artifact Instructions (Requires ~6 GB of disk space)
Instructions to train, test, and verify neural network classifiers. **NOTE:** Results will not exactly match paper results as weight initialization will affect training. While not significantly changing the results, this could alter tables and figures slightly.

### 1. Train and Test
1.1 Unzip the provided artifact
   
1.2 Navigate to the artifact directory
```
cd malware_nnv
```
   
1.3 Build and run the docker image
```
docker build --build-arg WORKDIR_PATH=$(pwd) -t malnnv_image .
```
```
sudo docker run --name malnnv -v $(pwd):$(pwd) --rm -it malnnv_image bash
```
**NOTE:** `-v $(pwd):$(pwd)` is important to see files locally for pt. 2 (Verify) and make plots for pt. 3 (Make Plots)

1.4 Setup and run the artifact
```
chmod +x run_artifact_train.sh && chmod +x setup.sh && ./setup.sh && ./run_artifact_train.sh
```
### 2. Verify
2.1 Open Matlab and navigate to the malware_nnv directory

2.2 Run the artifact verification
```
run_artifact_verify.m
```

### 3. Make Plots
3.1 Return to the docker image

3.2 Run:
```
chmod +x run_artifact_results.sh && ./run_artifact_results.sh
```

## Results Index
All results are saved to the `results` folder. The results are indexable by there reference name in the paper

| Artifact | Result Location | Description|
| -------- | -------- | -------- |
| **Table 4:**   | `results/Table_4_bodmas` | BODMAS classifier testing results.|
| **Table 4:**   | `results/Table_4_malimg` | Malimg classifier testing results.|
| **Figure 4a:** | `results/Fig_4a` | BODMAS - all features robustness results. |
| **Figure 4b:** | `results/Fig_4b` | BODMAS - all features time results. |
| **Figure 5a:** | `results/Fig_5a` | BODMAS - discrete and continuous features robustness results. |
| **Figure 5b:** |`results/Fig_5b` | BODMAS - discrete and continuous features time results. |
| **Figure 6a:** | `results/Fig_6a` | BODMAS - discrete features robustness results. |
| **Figure 6b:** | `results/Fig_6b` | BODMAS - discrete features time results. |
| **Figure 7a:** | `results/Fig_7a` | BODMAS - continuous features robustness results. |
| **Figure 7b:** | `results/Fig_7b` | BODMAS - continuous features time results. |
| **Figure 8a:** | `results/Fig_8a` | Malimg robustness results. |
| **Figure 8b:** |  `results/Fig_8b` | Malimg time results |

## Notes
If there is not enough space to run, try:
```
docker system prune
```
