#!/bin/bash
docker rm nnv-malware
docker rm nnenum-malware
docker rmi nnv-malware-image
docker rmi nnenum-malware-image
#
# Matlab docker for NNV experiments
#
NNV_IMAGE_ID="nnv-malware-image"
NNV_CONTAINER_ID="nnv-malware"
NNV_CONTAINER_PATH_MALIMG="/home/user/verify_malware/verify/nnv_verify/malimg/results"
NNV_CONTAINER_PATH_BODMAS="/home/user/verify_malware/verify/nnv_verify/bodmas/results"
docker build -t $NNV_IMAGE_ID -f Dockerfile_nnv .
docker run -it -v ${PWD}:/home/user/verify_malware --name $NNV_CONTAINER_ID $NNV_IMAGE_ID
#
# Move nnv results
#
NNV_LOCAL_FOLDER_MALIMG="results/raw/nnv_results/malimg"
NNV_LOCAL_FOLDER_BODMAS="results/raw/nnv_results/bodmas"
mkdir -p $NNV_LOCAL_FOLDER_MALIMG
mkdir -p $NNV_LOCAL_FOLDER_BODMAS

docker cp "$NNV_CONTAINER_ID":"${NNV_CONTAINER_PATH_MALIMG}/." "$NNV_LOCAL_FOLDER_MALIMG"
docker cp "$NNV_CONTAINER_ID":"${NNV_CONTAINER_PATH_BODMAS}/." "$NNV_LOCAL_FOLDER_BODMAS"
#
# remove nnv docker for space
#
docker rm $NNV_CONTAINER_ID
docker rmi $NNV_IMAGE_ID

#
# nnenum docker for NNV experiments
#
NNENUM_IMAGE_ID="nnenum-malware-image"
NNENUM_CONTAINER_ID="nnenum-malware"
NNENUM_CONTAINER_PATH_MALIMG="/home/user/verify_malware/verify/nnenum_verify/results/malimg"
NNENUM_CONTAINER_PATH_BODMAS="/home/user/verify_malware/verify/nnenum_verify/results/bodmas"
NNENUM_RESULTS_PATH="/home/user/verify_malware/results/artifacts"
docker build -t $NNENUM_IMAGE_ID -f Dockerfile_nnenum .
docker run -it -v ${PWD}:/home/user/verify_malware --name $NNENUM_CONTAINER_ID $NNENUM_IMAGE_ID

#
# Move nnenum results
#
mkdir "results/raw"
NNENUM_LOCAL_FOLDER="results/raw/nnenum_results"
mkdir $NNENUM_LOCAL_FOLDER
docker cp "$NNENUM_CONTAINER_ID":"$NNENUM_CONTAINER_PATH_MALIMG" "$NNENUM_LOCAL_FOLDER"
docker cp "$NNENUM_CONTAINER_ID":"$NNENUM_CONTAINER_PATH_BODMAS" "$NNENUM_LOCAL_FOLDER"

#
# Make figures and tables
#
LOCAL_RESULTS_PATH="results/artifacts"
mkdir -p $LOCAL_RESULTS_PATH
docker cp "$NNENUM_CONTAINER_ID":"$NNENUM_RESULTS_PATH/." "$LOCAL_RESULTS_PATH"
echo "All artifact results have been saved to: results/artifact"
